# Interâ€‘Service Communication in Microservices

> **Definition**: Mechanisms that let independent microservices talk to each other so they can act as a single cohesive system.

---
## 1Â Â Why It Matters

- Each microservice owns its own database and business domain.
- Features often require data or actions that span multiple services.
- Wellâ€‘designed contracts and transport choices directly impact **latency, resiliency, observability and team agility**.

---
## 2Â Â Communication Styles

|Style|Transport|Initiator waits?|Typical Useâ€‘cases|
|---|---|---|---|
|**Synchronous**|HTTP/HTTPS, gRPC|**Yes** â€“ caller blocks until response|CRUD lookâ€‘ups, realâ€‘time validations, userâ€‘facing flows|
|**Asynchronous**|Message broker (Kafka, RabbitMQ, NATS), Streaming|**No** â€“ eventually consistent|Eventâ€‘driven flows, audit trails, bulk data processing|

---
## 3Â Â Synchronous Communication in Spring Boot

Below are the most common HTTP client options, ordered from legacy to newest.  
All examples assume **JavaÂ 17+** and **SpringÂ BootÂ 3.2+**.
### 3.1Â RestTemplate (blocking, legacy)

```xml
<!-- Already included in spring-boot-starter-web -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

```java
@RestController
@RequiredArgsConstructor
class ProductFacade {

    private final RestTemplate restTemplate = new RestTemplate();

    @GetMapping("/products/{id}")
    ProductDto find(@PathVariable Long id) {
        return restTemplate.getForObject(
            "http://inventory-service/api/products/{id}", ProductDto.class, id);
    }
}
```

_Pros_ â€“ simple, mature ecosystem.  
_Cons_ â€“ blocking I/O, no fluent API, deprecated for new code.

---
### 3.2Â RestClientÂ (blocking, fluent â€“ SpringÂ 6.1/BootÂ 3.2+)

```java
@Configuration
class RestClientConfig {

    /** Builder is autoâ€‘configured by Spring Boot */
    @Bean
    RestClient inventoryClient(RestClient.Builder builder) {
        return builder
                .baseUrl("http://inventory-service/api")
                .defaultHeader("X-Caller", "product-service")
                .build();
    }
}
```

```java
// Usage
ProductDto product = inventoryClient.get()
        .uri("/products/{id}", id)
        .retrieve()
        .body(ProductDto.class);
```

> The builder inherits message converters and timeout settings from Spring Boot defaults, making the new client a dropâ€‘in replacement for RestTemplate. ([docs.spring.io](https://docs.spring.io/spring-boot/reference/io/rest-client.html?utm_source=chatgpt.com))

---
### 3.3Â WebClientÂ (reactive, nonâ€‘blocking)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
```

```java
@Bean
WebClient catalogClient(WebClient.Builder builder) {
    return builder.baseUrl("http://catalog-service/api").build();
}

Mono<ProductDto> mono = catalogClient.get()
    .uri("/products/{id}", id)
    .retrieve()
    .bodyToMono(ProductDto.class);
```

Ideal for highâ€‘concurrency, streaming or SSE useâ€‘cases.

---
### 3.4Â OpenFeignÂ (declarative, integrates with SpringÂ Cloud)

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

```java
@FeignClient(name = "inventory-service", path = "/api/products")
interface InventoryClient {

    @GetMapping("/{id}")
    ProductDto find(@PathVariable Long id);
}
```

Add `@EnableFeignClients` to a configuration class. Feign supports circuit breakers (Resilience4j), loadâ€‘balancing (Spring Cloud LoadBalancer) and HTTP/2.

---
### 3.5Â HTTP InterfacesÂ (@HttpExchange â€“ SpringÂ 6+) ğŸƒ

```java
@HttpExchange("/api/products")
public interface InventoryHttpApi {

    @GetExchange("/{id}")
    ProductDto find(@PathVariable Long id);

    @PostExchange
    ProductDto create(@RequestBody CreateProduct cmd);
}

@Configuration
class HttpInterfaceConfig {

    @Bean
    InventoryHttpApi inventoryHttpApi(RestClient.Builder builder) {
        return HttpServiceProxyFactory
                .builder(WebClientAdapter.forClient(builder.build()))
                .build()
                .createClient(InventoryHttpApi.class);
    }
}
```

_Pros_ â€“ concise, typeâ€‘safe, works with both blocking and reactive adapters.  
_Cons_ â€“ still new; lacks some advanced Feign features. ([docs.spring.io](https://docs.spring.io/spring-framework/reference/web/webflux-http-interface-client.html?utm_source=chatgpt.com), [docs.spring.io](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/service/invoker/HttpServiceProxyFactory.html?utm_source=chatgpt.com))

---
## 4Â Â Asynchronous Communication

### 4.1Â ApacheÂ Kafka (event streaming)

```xml
<dependency>
    <groupId>org.springframework.kafka</groupId>
    <artifactId>spring-kafka</artifactId>
</dependency>
```

```java
// Producer
@Service
@RequiredArgsConstructor
class OrderEventProducer {
    private final KafkaTemplate<String, OrderPlaced> template;
    void publish(OrderPlaced evt) {
        template.send("orders.placed", evt.orderId(), evt);
    }
}

// Consumer
@KafkaListener(topics = "orders.placed", groupId = "billing")
void handle(OrderPlaced evt) {
    // trigger payment
}
```

Configure `spring.kafka.bootstrap-servers` in _application.yml_. ([docs.spring.io](https://docs.spring.io/spring-boot/reference/messaging/kafka.html?utm_source=chatgpt.com))

**When to use:** highâ€‘throughput log of domain events, stream processing, exactlyâ€‘once guarantees.

---
### 4.2Â RabbitMQ (pointâ€‘toâ€‘point / pubâ€‘sub)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

```java
// Producer
@Autowired RabbitTemplate template;
template.convertAndSend("order.exchange", "order.created", order);

// Consumer
@RabbitListener(queues = "order.created.billing")
void onMessage(Order order) { ... }
```

Add `@EnableRabbit` on a configuration class to activate listeners. ([spring.io](https://spring.io/guides/gs/messaging-rabbitmq?utm_source=chatgpt.com), [docs.spring.io](https://docs.spring.io/spring-amqp/reference/amqp/receiving-messages/async-annotation-driven.html?utm_source=chatgpt.com))

---
## 5Â Â Choosing Between Sync vs Async

|Criteria|Prefer **Sync**|Prefer **Async**|
|---|---|---|
|User must wait for the response|âœ“||
|Loose coupling, temporal decoupling||âœ“|
|High fanâ€‘out or broadcast events||âœ“|
|Transaction spans services|âœ“ (saga/2â€‘phase)|âœ“ (event sourcing)|
|Tolerate higher latency||âœ“|

---
## 6Â Â Crossâ€‘Cutting Concerns

- **Timeouts & Retries** â€“ configure on client (RestClient/WebClient) and protect with **Resilience4j CircuitBreaker**.
- **Service Discovery** â€“ Spring Cloud LoadBalancer, Kubernetes DNS, or Envoy.
- **Tracing** â€“ OpenTelemetry + Zipkin/Grafana Tempo.
- **Schemaâ€¯Evolution** â€“ JSONâ€‘Schema, Protobuf, or Avro with a registry (e.g., Confluent).
- **Security** â€“ mTLS between pods, OAuth2/JWT propagation.
---
## 7Â Â Resources

- Spring Boot Reference â€“ _Calling REST Services_ ([docs.spring.io](https://docs.spring.io/spring-boot/reference/io/rest-client.html?utm_source=chatgpt.com))
- Spring Framework Reference â€“ _REST Clients_ ([docs.spring.io](https://docs.spring.io/spring-framework/reference/integration/rest-clients.html?utm_source=chatgpt.com))
- Spring Docs â€“ _HTTP Interface Client_ ([docs.spring.io](https://docs.spring.io/spring-framework/reference/web/webflux-http-interface-client.html?utm_source=chatgpt.com))
- Spring Kafka Docs â€“ _QuickÂ Tour_ ([docs.spring.io](https://docs.spring.io/spring-kafka/reference/quick-tour.html?utm_source=chatgpt.com))
- Spring AMQP Guide â€“ _Messaging with RabbitMQ_ ([spring.io](https://spring.io/guides/gs/messaging-rabbitmq?utm_source=chatgpt.com))
